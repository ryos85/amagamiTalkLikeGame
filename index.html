<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>アマガミ風・会話デモ</title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body class="compact">
    <header class="topbar">
        <div class="brand">会話デモ</div>
        <div class="status">
            <div class="meter">
                <label class="affectionLabelRow">
                    <span class="heart" aria-hidden="true">❤️</span>
                    ドキドキ度 <span id="affectionLabel">0</span> / 255
                    <span class="tier" id="tierLabel">普通</span>
                </label>

                <div class="bar">
                    <div id="affectionBar"></div>
                </div>
                
            </div>
            <div class="tension">
                <label>テンション</label>
                <span id="tensionBadge" class="badge badge-mid">Mid</span>
            </div>
        </div>
    </header>

    <main class="layout">
        <section class="portrait">
            <div class="portrait-frame">
                <div class="size-badge">442×786</div>
                <img id="portrait" src="assets/girl_mid.png" alt="girl" />
            </div>

            <div class="left-buttons" id="buttons"></div>
        </section>


        <section class="ui">
            <div class="dialog">
                <div id="log" class="log"></div>

                <!-- 追加：選択肢ボタンの置き場 -->
                <div id="choices" class="choices" hidden></div>

                <div class="inputRow">
                    <button id="clearLog" class="secondary">ログ消去</button>
                    <button id="resetState" class="danger">状態リセット</button>
                </div>
            </div>

            <details class="debug">
                <summary>デバッグ（テスト用）</summary>
                <div class="debug-grid">
                    <div>
                        <label>好感度</label>
                        <div class="row">
                            <button data-aff-delta="-10">-10</button>
                            <button data-aff-delta="-1">-1</button>
                            <input id="affectionInput" type="number" min="0" max="255" value="0" />
                            <button data-aff-delta="1">+1</button>
                            <button data-aff-delta="10">+10</button>
                        </div>
                    </div>
                    <div>
                        <label>テンション</label>
                        <div class="row">
                            <button data-tension="low">Low</button>
                            <button data-tension="mid">Mid</button>
                            <button data-tension="high">Hi</button>
                        </div>
                    </div>
                    <div>
                        <label>プレイヤー名</label>
                        <div class="row">
                            <input id="playerNameInput" type="text" maxlength="16" placeholder="あなた" />
                            <button id="applyPlayerName">適用</button>
                        </div>
                    </div>
                </div>
            </details>
        </section>
    </main>

    <!-- 終了オーバーレイ -->
    <div id="overlay" class="overlay" hidden>
        <div class="overlay-panel">
            <h2 id="overlayTitle">ゲームオーバー</h2>
            <p id="overlayMessage">・・・</p>
            <div class="overlay-actions">
                <button id="overlayReset" class="danger">状態リセット</button>
            </div>
        </div>
    </div>

    <footer class="foot">
        <small>会話文は <code>data/packs/*.pack.js</code> を編集してください。</small>
    </footer>

    <script src="data/dialogues.builder.js"></script>
    <script src="data/packs.manifest.js"></script>
    <script>
        (function () {
            const files = (window.DIALOGUE_PACK_FILES || []);
            const load = (src) => new Promise((res, rej) => {
                const s = document.createElement('script');
                s.src = src;
                s.onload = res;
                s.onerror = () => rej(new Error('Failed to load ' + src));
                document.body.appendChild(s);
            });
            (async () => {
                for (const f of files) await load(f);     // packs を順次ロード
                // ← packs 読み込み完了の合図（イベント）
                window.dispatchEvent(new Event('dialogue-packs-ready'));
            })();
        })();
    </script>

    <script src="js/main.js"></script>

</body>

</html>